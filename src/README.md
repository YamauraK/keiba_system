# 競馬データ分析システム

このアプリケーションは過去レース結果を蓄積し、コース条件から勝ち馬の傾向や投資シミュレーションを行える Laravel 製の管理ツールです。

## 主な機能

- **CSV インポート**: 競馬場・距離・天候などの条件と出走馬情報、各種払戻データを一括登録。
- **コース条件フィルタ**: 競馬場・コース種別・距離・天候・馬場状態・回り・開催日で絞り込み可能。
- **勝ち馬傾向の可視化**: 枠番・馬番・人気・性別・脚質ごとの勝利数／ROI を表示。
- **3着以内傾向**: 枠番・馬番・人気について最頻値と出現割合を確認。
- **購入シミュレーション**: 単勝／馬単／馬連／三連単それぞれを 100 円ずつ購入した場合の ROI を算出し、予算 10,000 円の推奨戦略を提示。

## セットアップ

1. 必要に応じて `.env` を作成し、データベース接続設定を行ってください。
2. 依存パッケージのインストール
   ```bash
   composer install
   npm install
   ```
3. マイグレーション実行
   ```bash
   php artisan migrate
   ```
4. アプリケーションを起動
   ```bash
   php artisan serve
   ```

> ※ このリポジトリは Docker / Sail のセットアップが含まれています。コンテナ実行の場合は `docker compose up -d` などご利用の環境に合わせて起動してください。

## CSV インポート

`/import` 画面から CSV ファイルをアップロードします。1 行に 1 頭分のデータを持つ形式を想定しています。主なカラムは以下の通りです。

| 列名 | 説明 |
| --- | --- |
| race_date | 開催日（YYYY-MM-DD） |
| race_name | レース名 |
| racecourse | 競馬場 |
| course_type | 芝 / ダート |
| weather | 天候 |
| track_condition | 馬場状態 |
| distance | 距離 (m) |
| direction | 右 / 左 |
| number_of_turns | コーナー数 |
| number_of_runners | 出走頭数 |
| frame_number | 枠番 |
| horse_number | 馬番 |
| horse_name | 馬名 |
| sex | 性別 |
| running_style | 脚質 |
| popularity | 単勝人気 |
| finish_position | 着順 |
| win_odds | 単勝オッズ |
| win_payout | 単勝払戻（100 円） |
| place_payout | 複勝払戻（100 円） |
| exacta_combination | 馬単の着順組み合わせ |
| exacta_payout | 馬単払戻（100 円） |
| quinella_combination | 馬連の組み合わせ |
| quinella_payout | 馬連払戻（100 円） |
| trifecta_combination | 三連単の組み合わせ |
| trifecta_payout | 三連単払戻（100 円） |

これらの列が存在しない場合でも、利用可能なデータのみ保存されます。

## 分析画面

トップページ(`/`)では、指定した条件で過去レースを抽出し、以下の情報を確認できます。

- 条件に合致したレース数・出走頭数・平均単勝人気
- 枠番・馬番・人気・性別・脚質別の勝利数と ROI
- 3 着以内の最多出現枠番／馬番／人気
- 各券種（単勝・馬単・馬連・三連単）の歴史的 ROI と 10,000 円投資時の想定収支

推奨プランは、ROI が最も高かった券種に 1 レース 100 円ずつ投資した場合の想定結果を文章で提示します。

## ライセンス

MIT License
